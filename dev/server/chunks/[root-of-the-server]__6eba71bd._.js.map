{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/foodcombocalc/app/api/lists/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport fs from \"fs/promises\";\nimport path from \"path\";\n\nconst LISTS_DIR = path.resolve(process.cwd(), \"lists\");\nconst ORDER_FILE = path.join(LISTS_DIR, \"_order.json\");\n\nasync function ensureDir() {\n  try {\n    await fs.mkdir(LISTS_DIR, { recursive: true });\n  } catch (e) {\n  }\n}\n\nexport async function GET() {\n  await ensureDir();\n  const files = await fs.readdir(LISTS_DIR).catch(() => []);\n  const jsonFiles = files.filter(f => f.endsWith(\".json\") && !f.startsWith(\"_\"));\n  const lists = jsonFiles.map(f => {\n    const m = f.match(/^(\\d+)\\.json$/);\n    return { filename: f, displayName: m ? `List ${m[1]}` : f.replace(/\\.json$/, \"\") };\n  });\n  return NextResponse.json(lists);\n}\n\nexport async function POST(req: Request) {\n  await ensureDir();\n  const body = await req.json().catch(() => ({} as any));\n  let { filename, content } = body as { filename?: string; content?: any };\n  if (!content) content = [];\n  if (!filename) {\n    const files = (await fs.readdir(LISTS_DIR)).filter(f => f.endsWith(\".json\") && !f.startsWith(\"_\"));\n    const nums = files.map(f => {\n      const m = f.match(/^(\\d+)\\.json$/);\n      return m ? Number(m[1]) : null;\n    }).filter(n => n !== null) as number[];\n    const used = new Set(nums);\n    let candidate = 1;\n    while (used.has(candidate)) candidate++;\n    filename = `${candidate}.json`;\n  }\n  const full = path.join(LISTS_DIR, filename);\n  async function uniqueName(orig: string) {\n    let dest = path.join(LISTS_DIR, orig);\n    try {\n      await fs.access(dest);\n      const m = orig.match(/^(.*?)(?:-(\\d+))?(\\.json)$/);\n      const base = m ? m[1] : orig.replace(/\\.json$/, '');\n      const ext = m ? m[3] : '.json';\n      let i = 1;\n      while (true) {\n        const name = `${base}-${i}${ext}`;\n        const p = path.join(LISTS_DIR, name);\n        try { await fs.access(p); i++; continue; } catch (e) { return name; }\n      }\n    } catch (e) {\n      return orig;\n    }\n  }\n\n  const safeFilename = await uniqueName(filename);\n  const safeFull = path.join(LISTS_DIR, safeFilename);\n  await fs.writeFile(safeFull, JSON.stringify(content, null, 2), \"utf-8\");\n  try {\n    let order: string[] = [];\n    try {\n      const txt = await fs.readFile(ORDER_FILE, 'utf-8');\n      order = JSON.parse(txt) || [];\n    } catch (e) {\n      order = [];\n    }\n    if (!order.includes(safeFilename)) {\n      order.push(safeFilename);\n      await fs.writeFile(ORDER_FILE, JSON.stringify(order, null, 2), 'utf-8');\n    }\n  } catch (e) {\n  }\n  return NextResponse.json({ filename: safeFilename });\n}"],"names":[],"mappings":"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"}}]
}